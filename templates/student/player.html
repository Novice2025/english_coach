{% extends "base.html" %}

{% block title %}{{ lesson.title }} | Learning Player{% endblock %}

{% block content %}
<div class="fixed inset-0 z-[100] flex flex-col md:flex-row bg-slate-900 text-white overflow-hidden">
    
    <div class="flex-1 flex flex-col bg-black relative">
        <div class="absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/90 to-transparent z-20 flex justify-between items-center">
            <div>
                <h1 class="text-lg font-black">{{ lesson.title }}</h1>
                <p class="text-xs text-indigo-400 font-bold uppercase tracking-widest">{{ course.title }}</p>
            </div>
            <div class="flex items-center space-x-4">
                <form action="{{ url_for('student.toggle_complete', lesson_id=lesson.id) }}" method="POST">
                    <input type="hidden" name="course_id" value="{{ course.id }}">
                    <button type="submit" class="text-xs font-black px-6 py-2 rounded-xl uppercase tracking-widest {% if is_completed %}bg-emerald-500{% else %}bg-indigo-600{% endif %}">
                        {% if is_completed %}‚úì Completed{% else %}Mark Complete{% endif %}
                    </button>
                </form>
                <a href="{{ url_for('student.my_courses') }}" class="text-2xl px-2 hover:text-indigo-400">&times;</a>
            </div>
        </div>

        <div class="flex-1 flex items-center justify-center bg-slate-950">
            {% if lesson.content_type == 'video' %}
                <div class="w-full aspect-video">
                    <iframe class="w-full h-full" 
                            src="{{ lesson.video_url|replace('watch?v=', 'embed/') }}" 
                            frameborder="0" 
                            allowfullscreen>
                    </iframe>
                </div>
            {% elif lesson.content_type == 'pdf' %}
                <div class="w-full h-full pt-20 pb-4 px-4">
                    <object data="{{ url_for('static', filename=lesson.pdf_file) }}" type="application/pdf" width="100%" height="100%">
                        <div class="p-10 text-center">
                            <a href="{{ url_for('static', filename=lesson.pdf_file) }}" class="bg-indigo-600 p-4 rounded-xl">Download PDF</a>
                        </div>
                    </object>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="w-full md:w-80 bg-slate-900 border-l border-slate-800 flex flex-col">
        <div class="p-6 border-b border-slate-800">
            <h2 class="font-black text-[10px] uppercase tracking-widest text-slate-500">Curriculum</h2>
            <div class="mt-2 w-full bg-slate-800 h-1.5 rounded-full overflow-hidden">
                <div class="bg-indigo-500 h-full" style="width: {{ course.progress_percent }}%;"></div>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto custom-scrollbar">
            {% for mod in modules %}
            <div class="border-b border-slate-800/50">
                <div class="px-6 py-3 bg-slate-950/50 text-[10px] font-black text-indigo-400 uppercase">
                    {{ mod.title }}
                </div>
                {% for les in mod.lessons %}
                <a href="{{ url_for('student.watch_lesson', course_id=course.id, lesson_id=les.id) }}" 
                   class="flex items-center px-6 py-4 border-l-4 {% if les.id == lesson.id %}bg-indigo-600/10 border-indigo-500 text-white{% else %}border-transparent text-slate-500 hover:bg-slate-800{% endif %}">
                    <span class="mr-3 text-sm">{% if les.content_type == 'pdf' %}üìÑ{% else %}‚ñ∂Ô∏è{% endif %}</span>
                    <div class="flex-1 truncate">
                        <p class="font-bold text-sm truncate">{{ les.title }}</p>
                        <p class="text-[9px] opacity-40 font-black uppercase">{{ les.duration_minutes }} MINS</p>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
</style>
{% endblock %}